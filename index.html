<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Energy System Stable</title>
<style>
body { margin:0; overflow:hidden; background:black; }
video { display:none; }
</style>
</head>
<body>

<video id="video" autoplay playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>

let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.z = 6;

let renderer = new THREE.WebGLRenderer({alpha:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// core sphere
let geometry = new THREE.SphereGeometry(0.7, 64, 64);
let material = new THREE.MeshBasicMaterial({ color: 0xaa00ff });
let sphere = new THREE.Mesh(geometry, material);
scene.add(sphere);

// ring
let ringGeo = new THREE.TorusGeometry(1.2,0.05,16,100);
let ringMat = new THREE.MeshBasicMaterial({color:0xff00ff});
let ring = new THREE.Mesh(ringGeo, ringMat);
ring.rotation.x = Math.PI/2;
scene.add(ring);

function animate(){
  requestAnimationFrame(animate);
  ring.rotation.z += 0.02;
  renderer.render(scene, camera);
}
animate();

// ---------------- HAND TRACKING ----------------
const video = document.getElementById("video");

navigator.mediaDevices.getUserMedia({video:true})
.then(stream=> video.srcObject = stream);

const hands = new Hands({
  locateFile:file =>
  `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands:1,
  modelComplexity:1,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

hands.onResults(results=>{
  if(results.multiHandLandmarks.length>0){
    const tip = results.multiHandLandmarks[0][8];
    let x = (tip.x-0.5)*10;
    let y = -(tip.y-0.5)*10;

    sphere.position.set(x,y,0);
    ring.position.set(x,y,0);
  }
});

const cam = new Camera(video,{
  onFrame: async()=>{ await hands.send({image:video}); },
  width:640,
  height:480
});
cam.start();

</script>
</body>
</html>
